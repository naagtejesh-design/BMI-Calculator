<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h2>BMI Calculator</h2>
        <form id="bmiForm" onsubmit="event.preventDefault(); calculateBMI();">
            <label>Gender:</label>
            <div class="gender-selection">
                <label class="radio-label">
                    <input type="radio" name="gender" value="male" checked>
                    <span>Male</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="gender" value="female">
                    <span>Female</span>
                </label>
            </div>

            <label for="age">Age (years):</label>
            <input type="number" id="age" placeholder="Enter age" min="10" max="120" required />

            <label for="height">Height (cm):</label>
            <input type="number" id="height" placeholder="Enter height" required />

            <label for="weight">Weight (kg):</label>
            <input type="number" id="weight" placeholder="Enter weight" required />

            <label for="activity">Activity Level:</label>
            <select id="activity" class="activity-select">
                <option value="1.2">Sedentary (little or no exercise)</option>
                <option value="1.375">Lightly active (exercise 1-3 days/week)</option>
                <option value="1.55" selected>Moderately active (exercise 3-5 days/week)</option>
                <option value="1.725">Very active (exercise 6-7 days/week)</option>
                <option value="1.9">Extra active (very intense exercise daily)</option>
            </select>
            <button type="submit">Calculate BMI</button>
        </form>

        <div class="gauge-container" id="gaugeContainer" style="display:none;">
            <svg viewBox="0 0 200 120" class="gauge">
                <defs>
                    <linearGradient id="underweight" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#5dade2;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="normal" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#2ecc71;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#58d68d;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="overweight" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#f39c12;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#f5b041;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="obese" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec7063;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <path d="M 20 100 A 80 80 0 0 1 68 32" fill="none" stroke="url(#underweight)" stroke-width="15"/>
                <path d="M 68 32 A 80 80 0 0 1 132 32" fill="none" stroke="url(#normal)" stroke-width="15"/>
                <path d="M 132 32 A 80 80 0 0 1 180 100" fill="none" stroke="url(#overweight)" stroke-width="15"/>
                <path d="M 180 100 A 80 80 0 0 1 185 110" fill="none" stroke="url(#obese)" stroke-width="15"/>
                <text x="25" y="110" font-size="10" fill="#555">15</text>
                <text x="60" y="25" font-size="10" fill="#555">18.5</text>
                <text x="95" y="15" font-size="10" fill="#555">25</text>
                <text x="135" y="25" font-size="10" fill="#555">30</text>
                <text x="170" y="110" font-size="10" fill="#555">40</text>
                <line id="needle" x1="100" y1="100" x2="100" y2="30" stroke="#333" stroke-width="3" stroke-linecap="round" style="transform-origin: 100px 100px; transition: transform 1s ease-out;"/>
                <circle cx="100" cy="100" r="8" fill="#333"/>
                <circle cx="100" cy="100" r="4" fill="#fff"/>
            </svg>
            <div class="bmi-value" id="bmiValue">--</div>
            <div class="bmi-category" id="bmiCategory">Calculate your BMI</div>
        </div>

        <div class="calorie-info" id="calorieInfo" style="display:none;">
            <h3>ðŸ“Š Recommended Daily Intake</h3>
            <div id="calorieDetails"></div>
            <div id="macroDetails"></div>
        </div>

        <div class="result" id="result"></div>
        <div class="error" id="error"></div>
    </div>

    <!-- You can keep your info-container sections as provided earlier! -->

    <script>
    function calculateBMI() {
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('weight').value);
      const age = parseInt(document.getElementById('age').value);
      const gender = document.querySelector('input[name="gender"]:checked').value;
      const activity = parseFloat(document.getElementById('activity').value);

      const error = document.getElementById('error');
      error.textContent = '';
      if (!height || !weight || !age || height <= 0 || weight <= 0 || age < 10) {
        error.textContent = 'âš ï¸ Please enter valid details.';
        return;
      }

      fetch('/calculate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({height, weight, age, gender, activity})
      })
      .then(response => response.json())
      .then(data => {
          // Gauge, Results
          const bmi = data.bmi;
          const category = data.category;
          const maintenanceCalories = data.calories;
          const goalCalories = data.goal_calories;
          const calorieGoal = data.calorie_goal;
          const macros = data.macros;

          const gaugeContainer = document.getElementById('gaugeContainer');
          const needle = document.getElementById('needle');
          const bmiValue = document.getElementById('bmiValue');
          const bmiCategory = document.getElementById('bmiCategory');
          gaugeContainer.style.display = 'block';
          bmiValue.textContent = bmi;
          bmiCategory.textContent = category;
          let angle = Math.max(15, Math.min(40, bmi));
          let rotation = ((angle - 15) / 25) * 180 - 90;
          needle.style.transform = `rotate(${rotation}deg)`;

          document.getElementById('calorieInfo').style.display = 'block';
          document.getElementById('calorieDetails').innerHTML = `
            <div class="calorie-row">
                <span class="calorie-label">Maintenance Calories:</span>
                <span class="calorie-value">${maintenanceCalories} cal/day</span>
            </div>
            <div class="calorie-row highlight">
                <span class="calorie-label">Recommended Goal:</span>
                <span class="calorie-value">${goalCalories} cal/day</span>
            </div>
            <div class="calorie-tip">${calorieGoal}</div>
          `;
          document.getElementById('macroDetails').innerHTML = `
            <div class="calorie-row">
                <span class="calorie-label">Protein:</span>
                <span class="calorie-value">${macros.protein_g} g</span>
            </div>
            <div class="calorie-row">
                <span class="calorie-label">Fat:</span>
                <span class="calorie-value">${macros.fat_g} g</span>
            </div>
            <div class="calorie-row">
                <span class="calorie-label">Carbohydrate:</span>
                <span class="calorie-value">${macros.carb_g} g</span>
            </div>
          `;
          let message;
          if (category === 'Underweight') {
              message = 'Increase your healthy calorie and protein intake.';
          } else if (category === 'Normal Weight') {
              message = 'Maintain your balanced diet and activity.';
          } else {
              message = 'Aim for a calorie deficit and be active.';
          }
          document.getElementById('result').textContent = message;
      })
      .catch(() => {
          document.getElementById('error').textContent = "Calculation failed. Please check input values!";
      });
    }
    </script>
</body>
</html>